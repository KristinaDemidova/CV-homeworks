
## HW 2.5

–í —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å—Å–ª–µ–¥—É–µ—Ç—Å—è –≤–ª–∏—è–Ω–∏–µ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é **Stable Diffusion** –∏ **ControlNet (Canny)**.

–í –∫–∞—á–µ—Å—Ç–≤–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **Flowers Recognition** (5 –∫–ª–∞—Å—Å–æ–≤: tulip, rose, sunflower, dandelion, daisy)(https://www.kaggle.com/datasets/alxmamaev/flowers-recognition/data).

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
.
‚îú‚îÄ‚îÄ data/                   # –î–∞—Ç–∞—Å–µ—Ç—ã (Train/Val/Synthetic)
‚îú‚îÄ‚îÄ generator.py            # –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (SD + ControlNet)
‚îú‚îÄ‚îÄ train.py                # –°–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ main.py                 # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è -> –æ–±—É—á–µ–Ω–∏–µ -> —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ)
‚îú‚îÄ‚îÄ split_data.py           # –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è Kaggle-–¥–∞—Ç–∞—Å–µ—Ç–∞
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md               # –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
   ```bash
   pip install -r requirements.txt
   ```

2. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
   –°–∫–∞—á–∞–π—Ç–µ –¥–∞—Ç–∞—Å–µ—Ç Flowers —Å Kaggle –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ –µ–≥–æ –Ω–∞ Train/Val:
   ```bash
   # (–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ kaggle.json)
   kaggle datasets download -d alxmamaev/flowers-recognition
   unzip flowers-recognition.zip -d data/
   python split_data.py
   ```

3. **–ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞:**
   –°–∫—Ä–∏–ø—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–Ω—Ç–µ—Ç–∏–∫—É, –æ–±—É—á–∏—Ç Baseline –∏ Augmented –º–æ–¥–µ–ª–∏, —Å–æ—Ö—Ä–∞–Ω–∏—Ç –≥—Ä–∞—Ñ–∏–∫.
   ```bash
   python main.py
   ```

---

## üõ† –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø–∞–π–ø–ª–∞–π–Ω **Stable Diffusion v1.5 + ControlNet (Canny)**.

### –ü—Ä–æ–±–ª–µ–º–∞: "–ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏" (–ù–∞—Å–µ–∫–æ–º—ã–µ)
–ù–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–æ—Ç–æ —á–∞—Å—Ç–æ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –Ω–∞—Å–µ–∫–æ–º—ã–µ (–ø—á–µ–ª—ã, –∂—É–∫–∏). ControlNet –≤—ã–¥–µ–ª—è–ª –∏—Ö –∫–æ–Ω—Ç—É—Ä—ã, –∏ –º–æ–¥–µ–ª—å –ø—ã—Ç–∞–ª–∞—Å—å —Ä–∏—Å–æ–≤–∞—Ç—å "–≥–∏–±—Ä–∏–¥—ã" —Ü–≤–µ—Ç–æ–≤ –∏ –Ω–∞—Å–µ–∫–æ–º—ã—Ö.

### –†–µ—à–µ–Ω–∏–µ
1. **–ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `Gaussian Blur` –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∫–∞—Ä—Ç—ã Canny. –≠—Ç–æ —Å–≥–ª–∞–¥–∏–ª–æ –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏ (–ª–∞–ø–∫–∏, —É—Å–∏–∫–∏), –æ—Å—Ç–∞–≤–∏–≤ —Ç–æ–ª—å–∫–æ –∫—Ä—É–ø–Ω—ã–µ —Ñ–æ—Ä–º—ã –ª–µ–ø–µ—Å—Ç–∫–æ–≤.
2. **Negative Prompting:** –í –ø—Ä–æ–º–ø—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ç–æ–∫–µ–Ω—ã: `insect, bee, ant, legs, eyes`.

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ê–Ω–∞–ª–∏–∑ (Ablation Study)

–ë—ã–ª–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±—É—á–µ–Ω–∏—è:
1. **Baseline:** –û–±—É—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
2. **Synthetic+:** –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å–º–µ—Å–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å daisy, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —É–¥–∞–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä–Ω–æ 200 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å).

### –ì—Ä–∞—Ñ–∏–∫ –º–µ—Ç—Ä–∏–∫ (Validation Accuracy)

![Learning Curve](./ablation_results.png)

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ –≥—Ä–∞—Ñ–∏–∫—É:

1.  **–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –æ–±—É—á–µ–Ω–∏—è:**
    –ù–∞ 4-–π —ç–ø–æ—Ö–µ –≤–∏–¥–Ω–æ —Ä–µ–∑–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ (**Crash**) —É Baseline –º–æ–¥–µ–ª–∏ (—Å–∏–Ω—è—è –ª–∏–Ω–∏—è) –¥–æ ~0.60. –í —Ç–æ –∂–µ –≤—Ä–µ–º—è –º–æ–¥–µ–ª—å —Å —Å–∏–Ω—Ç–µ—Ç–∏–∫–æ–π (–æ—Ä–∞–Ω–∂–µ–≤–∞—è –ª–∏–Ω–∏—è) –ø—Ä–æ–¥–æ–ª–∂–∏–ª–∞ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç. –≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ **—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤—É—é—Ç –∫–∞–∫ —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ç–æ—Ä**, –¥–µ–ª–∞—è –º–æ–¥–µ–ª—å –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤–æ–π –∫ –Ω–µ—É–¥–∞—á–Ω—ã–º –±–∞—Ç—á–∞–º –∏ –≤—ã–±—Ä–æ—Å–∞–º.

2.  **–ü—Ä–∏—Ä–æ—Å—Ç –∫–∞—á–µ—Å—Ç–≤–∞ (SOTA):**
    –ü–∏–∫–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (Peak Accuracy) —É –º–æ–¥–µ–ª–∏ —Å —Å–∏–Ω—Ç–µ—Ç–∏–∫–æ–π –≤—ã—à–µ:
    *   **Baseline Peak:** ~0.85
    *   **Synthetic+ Peak:** ~0.88
    
    –ú–æ–¥–µ–ª—å —Å–º–æ–≥–ª–∞ –≤—ã—É—á–∏—Ç—å –±–æ–ª–µ–µ –æ–±–æ–±—â–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –±–ª–∞–≥–æ–¥–∞—Ä—è –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤.

3.  **–î–∏–Ω–∞–º–∏–∫–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏:**
    –í –ø–µ—Ä–≤—ã–µ —ç–ø–æ—Ö–∏ (0-3) Baseline —É—á–∏—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ "—á–∏—â–µ". –°–∏–Ω—Ç–µ—Ç–∏–∫–∞ –≤–Ω–æ—Å–∏—Ç —à—É–º, –∏–∑-–∑–∞ —á–µ–≥–æ —Å—Ç–∞—Ä—Ç –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π, –Ω–æ –Ω–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ (5+ —ç–ø–æ—Ö) —ç—Ç–æ –¥–∞–µ—Ç –≤—ã–∏–≥—Ä—ã—à –≤ –º–µ—Ç—Ä–∏–∫–∞—Ö.

---

## üñº–ü—Ä–∏–º–µ—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

*(–°—é–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç—ã: –û—Ä–∏–≥–∏–Ω–∞–ª | Canny Map | –†–µ–∑—É–ª—å—Ç–∞—Ç)*

| Original (Real) |  Synthetic Output |
|:---:|:---:|
| <img src="./data/flowers/4666648087_b10f376f19.jpg" width="200"> | <img src="./data/syntetic_data/4666648087_b10f376f19_synth_0.png" width="200"> |
| <img src="./data/flowers/5133243796_44de429de5_m.jpg" width="200"> | <img src="./data/syntetic_data/5133243796_44de429de5_m_synth_1.png" width="200"> |

---

##  –ò—Ç–æ–≥

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ControlNet –æ–ø—Ä–∞–≤–¥–∞–ª–æ —Å–µ–±—è. –ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–±–æ—Ä—å–±–∞ —Å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏), –∏—Ç–æ–≥–æ–≤–∞—è –º–æ–¥–µ–ª—å –ø–æ–∫–∞–∑–∞–ª–∞ –ø—Ä–∏—Ä–æ—Å—Ç **+3% Accuracy** –∏ –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å Baseline.
```